---
import '../styles/global.css';
import { SEO } from 'astro-seo';
import { SITE_TITLE, TWITTER_HANDLE } from '../consts';

interface Props {
  title: string;
  description: string;
  image?: string;
  type?: 'website' | 'article';
  pubDate?: Date;
  updatedDate?: Date;
  pageType?: 'home' | 'blog-post' | 'blog-list' | 'default';
}

const canonicalURL = new URL(Astro.url.pathname, Astro.site).href;
const siteURL = Astro.site?.href ?? 'https://waris.asent.app';

const {
  title,
  description,
  image = '/favicon.svg',
  type = 'website',
  pubDate,
  updatedDate,
  pageType = 'default',
} = Astro.props;

const resolvedImage = new URL(image, Astro.url).href;

// --- JSON-LD Structured Data ---

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: SITE_TITLE,
  url: siteURL,
};

const personSchema = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: 'Waris Reshi',
  url: siteURL,
  sameAs: [
    'https://github.com/wrsrsh',
    'https://www.linkedin.com/in/wrsrsh/',
    `https://x.com/${TWITTER_HANDLE.replace('@', '')}`,
  ],
  jobTitle: 'Co-founder',
  worksFor: {
    '@type': 'Organization',
    name: 'Asent',
    url: 'https://asent.app',
  },
};

const articleSchema = pubDate
  ? {
      '@context': 'https://schema.org',
      '@type': 'Article',
      headline: title,
      url: canonicalURL,
      datePublished: pubDate.toISOString(),
      ...(updatedDate && { dateModified: updatedDate.toISOString() }),
      author: {
        '@type': 'Person',
        name: 'Waris Reshi',
        url: siteURL,
      },
      publisher: {
        '@type': 'Person',
        name: 'Waris Reshi',
        url: siteURL,
      },
      ...(image !== '/favicon.svg' && {
        image: resolvedImage,
      }),
    }
  : null;

function getJsonLdScripts() {
  const schemas: object[] = [websiteSchema];
  if (pageType === 'home') {
    schemas.push(personSchema);
  }
  if (pageType === 'blog-post' && articleSchema) {
    schemas.push(articleSchema);
  }
  return schemas;
}

const jsonLdSchemas = getJsonLdScripts();
---

<!-- Global Metadata -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5" />
<link rel="shortcut icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%3E%3Ctext%20y='.9em'%20font-size='90'%3E%E2%9B%B0%EF%B8%8F%3C/text%3E%3C/svg%3E" />
<link rel="sitemap" href="/sitemap-index.xml" />
<link
  rel="alternate"
  type="application/rss+xml"
  title={SITE_TITLE}
  href={new URL('rss.xml', Astro.site)}
/>
<meta name="generator" content={Astro.generator} />
<meta name="keywords" content="waris reshi, asent, srinagar, technology, ai, human performance, entrepreneurship, waris abass, waris, waris abass reshi" />

<!-- SEO Meta Tags (via astro-seo) -->
<SEO
  title={title}
  description={description}
  canonical={canonicalURL}
  openGraph={{
    basic: {
      title: title,
      type: type,
      image: resolvedImage,
      url: canonicalURL,
    },
    optional: {
      description: description,
      siteName: SITE_TITLE,
    },
    ...(type === 'article' && pubDate
      ? {
          article: {
            publishedTime: pubDate.toISOString(),
            ...(updatedDate && { modifiedTime: updatedDate.toISOString() }),
            authors: ['Waris Reshi'],
          },
        }
      : {}),
  }}
  twitter={{
    card: 'summary',
    site: TWITTER_HANDLE,
    creator: TWITTER_HANDLE,
    title: title,
    image: resolvedImage,
    description: description,
  }}
/>

<!-- JSON-LD Structured Data -->
{jsonLdSchemas.map((schema) => (
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
))}
