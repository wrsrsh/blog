---
import type { CollectionEntry } from "astro:content";
import Layout from "../components/Layout.astro";
import FormattedDate from "../components/FormattedDate.astro";
import { Image } from "astro:assets";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<Layout title={title} description={description} image={heroImage?.src} type="article" pubDate={pubDate} updatedDate={updatedDate} pageType="blog-post">
  <article>

    <header class="pt-14">
      <h1 class="text-xl font-semibold mb-2">{title}</h1>

      <p style="color: var(--color-muted);">
        <FormattedDate date={pubDate} />
        {
          updatedDate && (
            <span class="italic">
              (Updated: <FormattedDate date={updatedDate} />)
            </span>
          )
        }
      </p>
    </header>


    <div class="hero-image py-4">
      {
        heroImage && (
          <Image
            width={1020}
            height={510}
            src={heroImage}
            alt=""
          />
        )
      }
    </div>
    <div class="prose">
      <slot />
    </div>

    <p
      class="mt-10 pt-4 border-t border-dashed"
      style="border-color: var(--color-border);"
    >
      <a href="/">&larr; Back to home</a><sup><kbd class="text-[10px] font-mono select-none" style="color: var(--color-muted);">[w]</kbd></sup>
    </p>
  </article>
</Layout>

<script>
  let lastKey = "";
  document.addEventListener("keydown", (e) => {
    if (
      e.target instanceof HTMLInputElement ||
      e.target instanceof HTMLTextAreaElement ||
      (e.target as HTMLElement).isContentEditable
    ) return;

    const step = 60;
    const jump = window.innerHeight * 0.5;

    if (e.key === "g" && !e.shiftKey) {
      if (lastKey === "g") {
        window.scrollTo(0, 0);
        lastKey = "";
        return;
      }
      lastKey = "g";
      setTimeout(() => { lastKey = ""; }, 500);
      return;
    }

    if (e.key === "G") {
      window.scrollTo(0, document.body.scrollHeight);
      lastKey = "";
      return;
    }

    lastKey = "";

    switch (e.key) {
      case "j":
        window.scrollBy(0, step);
        break;
      case "k":
        window.scrollBy(0, -step);
        break;
      case "}":
        window.scrollBy(0, jump);
        break;
      case "{":
        window.scrollBy(0, -jump);
        break;
    }
  });
</script>
