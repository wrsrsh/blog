---
import Layout from "../components/Layout.astro"
import { getCollection } from "astro:content";
import FormattedDate from "../components/FormattedDate.astro";
import { SITE_TITLE } from "../consts";

const posts = (await getCollection("blog")).filter(
  (post) => post.data.published === true
).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<Layout
  title={`Blog Archive - ${SITE_TITLE}`}
  description="Essays and thoughts on AI, technology, and life."
  pageType="blog-list"
>
  <section class="pt-14">
    <ul class="list-none p-0 m-0">
      {
        posts.map((post, i) => (
          <li class="flex mb-2 justify-between">
            <span class="flex items-center">
              {i < 9 && <sup><kbd class="text-[10px] mr-1 font-mono select-none" style="color: var(--color-muted);">[{i + 1}]</kbd></sup>}
              <a href={`/post/${post.id}/`}>{post.data.title}</a>
            </span>
            <span style="color: var(--color-muted);" class="whitespace-nowrap">
              <FormattedDate date={post.data.pubDate} />
            </span>
          </li>
        ))
      }
    </ul>

    {
      posts.length === 0 && (
        <p style="color: var(--color-muted);">No posts yet.</p>
      )
    }
  </section>

  <script>
    document.addEventListener("keydown", (e) => {
      if (
        e.target instanceof HTMLInputElement ||
        e.target instanceof HTMLTextAreaElement ||
        (e.target as HTMLElement).isContentEditable
      ) return;

      const num = parseInt(e.key);
      if (num >= 1 && num <= 9) {
        const links = document.querySelectorAll<HTMLAnchorElement>("section ul li a");
        const link = links[num - 1];
        if (link) {
          window.location.href = link.href;
        }
      }
    });
  </script>
</Layout>
